<!DOCTYPE html>
<html>
<head>
  <title>TEXNET User Expiry Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    input { width: 100%; padding: 10px; margin-bottom: 20px; font-size: 16px; }
    table { border-collapse: collapse; width: 100%; background: #fff; }
    th, td { padding: 12px; border: 1px solid #ccc; text-align: left; }
    tr.green { background-color: #e6ffe6; }
    tr.yellow { background-color: #fff8e1; }
    tr.red { background-color: #ffe6e6; }
    .status { font-weight: bold; }
  </style>
</head>
<body>
  <h2>TEXNET User Expiry Dashboard</h2>
  <input type="text" id="search" placeholder="Search by name or phone...">
  <table id="userTable">
    <thead>
      <tr><th>Name</th><th>Phone</th><th>Expiry</th><th>Status</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    function loadCSV(url, callback) {
      fetch(url)
        .then(res => res.text())
        .then(text => callback(text));
    }

    function parseCSV(text) {
      const rows = text.trim().split('\n').map(row => row.split(','));
      const tbody = document.querySelector("#userTable tbody");
      tbody.innerHTML = "";

      const now = new Date();

      for (let i = 1; i < rows.length; i++) {
        const [name, phone, expiryStr] = rows[i];
        const expiry = new Date(expiryStr);
        const diffMs = expiry - now;
        const diffHrs = diffMs / (1000 * 60 * 60);

        let status = "";
        let rowClass = "";

        if (diffHrs < 0) {
          status = "❌ Expired";
          rowClass = "red";
        } else if (diffHrs <= 24) {
          status = "⚠️ Almost expired";
          rowClass = "yellow";
        } else {
          status = "✅ Active";
          rowClass = "green";
        }

        const row = `<tr class="${rowClass}">
          <td>${name}</td><td>${phone}</td><td>${expiryStr}</td><td class="status">${status}</td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      }
    }

    // Filter table
    document.querySelector("#search").addEventListener("input", function () {
      const value = this.value.toLowerCase();
      document.querySelectorAll("#userTable tbody tr").forEach(row => {
        const rowText = row.textContent.toLowerCase();
        row.style.display = rowText.includes(value) ? "" : "none";
      });
    });

    // Load the CSV
    loadCSV("user-expiry.csv", parseCSV);
  </script>
</body>
</html>
